// Generated by CoffeeScript 1.6.2
var chatRoomController;

chatRoomController = {
  create: function(request, response) {
    return Object.create(this, {
      request: {
        value: request
      },
      response: {
        value: response
      }
    });
  },
  post: function() {
    var body,
      _this = this;

    body = "";
    this.request.addListener("data", function(chunk) {
      return body += chunk;
    });
    return this.request.addListener("end", function() {
      var data;

      data = JSON.parse(decodeURI(body)).data;
      return _this.chatRoom.addMessage(data.user, data.message).then(function() {
        return _this.respond(201);
      }).done();
    });
  },
  get: function() {
    var id,
      _this = this;

    id = this.request.headers["x-access-token"] || "0";
    return this.chatRoom.waitForMessagesSince(id).then(function(msgs) {
      return _this.respond(201, {
        message: msgs,
        token: msgs[msgs.length - 1].id
      });
    }).done();
  },
  respond: function(status, data) {
    var strData;

    strData = JSON.stringify(data);
    this.response.writeHead(status, {
      "Content-Type": "application/json",
      "Content-Length": strData.length
    });
    return this.response.end();
  }
};

module.exports = chatRoomController;
